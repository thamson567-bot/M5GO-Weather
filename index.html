<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Smart Office Hub</title>
<style>
:root{
  --bg:#0f0f23;
  --card:#1a1a2e;
  --text:#e0e0e0;
  --accent:#4ecdc4;
  --accent2:#ffd93d;
}

*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding:20px}

.wrap{max-width:1200px;margin:0 auto}
h1{text-align:center;margin-bottom:30px;color:var(--accent)}

.office-map{position:relative;width:100%;max-width:800px;height:450px;margin:30px auto;
background:#1a1a2e;border:5px solid #333;border-radius:4px}

.room4-outer{position:absolute;left:0;top:0;width:45%;height:50%;
border-right:5px solid #333;border-bottom:5px solid #333;background:#2a2a3e;transition:background 0.5s}

.room3-outer{position:absolute;left:45%;top:0;width:55%;height:50%;
border-bottom:5px solid #333;background:#2a2a3e;transition:background 0.5s}

.room1-outer{position:absolute;left:0;top:50%;width:62%;height:50%;background:#2a2a3e}
.room1-main-door{position:absolute;left:20%;bottom:-5px;width:80px;height:40px;
background:#1a1a2e;border:3px solid #333;border-bottom:none}

.room2-outer{position:absolute;left:62%;top:50%;width:38%;height:50%;
border-left:5px solid #333;background:#2a2a3e;transition:background 0.5s}

.gateway{position:absolute;left:13%;bottom:35px;font-size:0.9rem;opacity:0.85;
padding:6px 14px;background:rgba(0,0,0,.4);border-radius:6px}

.room-content{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
.room-label{font-size:3rem;font-weight:bold;opacity:0.9}
.light-bulb{width:80px;height:80px;border-radius:50%;background:#333;
margin:15px auto 0;display:flex;align-items:center;justify-content:center;
font-size:3rem;transition:all 0.6s;border:3px solid #555}
.light-bulb.on{box-shadow:0 0 50px rgba(255,255,255,0.9);border-color:#fff}

.room-status{font-size:0.85rem;margin-top:8px;opacity:0.8;font-weight:500}
.room-status.lit{color:#0f0}
.room-status.off{color:#888}

.status{text-align:center;padding:20px;background:var(--card);border-radius:12px;margin:20px auto}
.status h3{margin-bottom:10px;color:var(--accent2)}
</style>
</head>
<body>

<div class="wrap">
  <h1>üè¢ Smart Office Hub</h1>
  
  <div class="status">
    <h3 id="statusText">Loading...</h3>
  </div>

  <div class="office-map">
    <div class="room4-outer" id="room4bg" style="display:none">
      <div class="room-content">
        <div class="room-label">4</div>
        <div class="light-bulb" id="bulb4">üí°</div>
        <div class="room-status off" id="status4">OFF</div>
      </div>
    </div>
    
    <div class="room3-outer" id="room3bg">
      <div class="room-content">
        <div class="room-label">1</div>
        <div class="light-bulb" id="bulb3">üí°</div>
        <div class="room-status off" id="status3">OFF</div>
      </div>
    </div>
    
    <div class="room1-outer" id="room1bg">
      <div class="room1-main-door"></div>
      <div class="room-content">
        <div class="room-label">M</div>
      </div>
    </div>
    
    <div class="room2-outer" id="room2bg">
      <div class="room-content">
        <div class="room-label">2</div>
        <div class="light-bulb" id="bulb2">üí°</div>
        <div class="room-status off" id="status2">OFF</div>
      </div>
    </div>
    
    <div class="gateway">Main Entrance</div>
  </div>
</div>

<script>
var CHANNEL = '3260324';
var READ_KEY = 'RSDE9TXRGDX5HIL0';

function $(id){return document.getElementById(id)}

function updateLights(room1Level, room2Level) {
  var bulb2 = $('bulb2');
  var bulb3 = $('bulb3');
  var room2 = $('room2bg');
  var room3 = $('room3bg');
  var status2 = $('status2');
  var status3 = $('status3');
  var statusText = $('statusText');
  
  // Reset
  bulb2.classList.remove('on');
  bulb3.classList.remove('on');
  bulb2.style.background = '#333';
  bulb3.style.background = '#333';
  room2.style.background = '#2a2a3e';
  room3.style.background = '#2a2a3e';
  status2.textContent = 'OFF';
  status3.textContent = 'OFF';
  status2.className = 'room-status off';
  status3.className = 'room-status off';
  
  var active = [];
  
  // Room 1 (M5Stack)
  if(room1Level > 0) {
    bulb3.classList.add('on');
    var color = room1Level <= 25 ? '#ffff99' : room1Level <= 50 ? '#ffffaa' : 
                room1Level <= 75 ? '#99ffff' : '#ffffff';
    bulb3.style.background = 'radial-gradient(circle, ' + color + ', #888)';
    room3.style.background = 'rgba(255, 255, 200, 0.15)';
    status3.textContent = room1Level + '%';
    status3.className = 'room-status lit';
    active.push('Room 1: ' + room1Level + '%');
  }
  
  // Room 2 (RGB LED)
  if(room2Level > 0) {
    bulb2.classList.add('on');
    var color = room2Level <= 25 ? '#ffff99' : room2Level <= 50 ? '#ffffaa' : 
                room2Level <= 75 ? '#99ffff' : '#ffffff';
    bulb2.style.background = 'radial-gradient(circle, ' + color + ', #888)';
    room2.style.background = 'rgba(255, 255, 200, 0.15)';
    status2.textContent = room2Level + '%';
    status2.className = 'room-status lit';
    active.push('Room 2: ' + room2Level + '%');
  }
  
  if(active.length === 0) {
    statusText.textContent = 'All Lights OFF';
  } else {
    statusText.textContent = active.join(' | ');
  }
}

function fetchData() {
  var url = 'https://api.thingspeak.com/channels/' + CHANNEL + 
            '/feeds/last.json?api_key=' + READ_KEY;
  
  fetch(url)
    .then(res => res.json())
    .then(d => {
      var room1 = parseInt(d.field4) || 0;
      var room2 = parseInt(d.field5) || 0;
      
      updateLights(room1, room2);
    })
    .catch(err => {
      $('statusText').textContent = 'Error: ' + err.message;
    });
}

fetchData();
setInterval(fetchData, 5000);
</script>

</body>
</html>
