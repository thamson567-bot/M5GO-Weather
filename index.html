<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>M5GO Weather Station</title>
<style>
:root{--bg:#0f0f23;--card:#1a1a2e;--card2:#16213e;--text:#e0e0e0;--dim:#888;--r:16px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}

/* Top Header */
.top{background:linear-gradient(135deg,#0a1628,#1a3a5c,#2d6187,#3a7ca5);
color:#fff;padding:24px 20px 44px;text-align:center;position:relative;overflow:hidden}
.top::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;
background:radial-gradient(circle,rgba(255,255,255,.03) 0%,transparent 60%);animation:shimmer 8s infinite}
@keyframes shimmer{0%,100%{transform:rotate(0deg)}50%{transform:rotate(180deg)}}
.top::after{content:'';position:absolute;bottom:0;left:0;right:0;height:44px;
background:var(--bg);border-radius:50% 50% 0 0/100% 100% 0 0}
.top h1{font-size:1.1rem;font-weight:400;opacity:.7;letter-spacing:3px;text-transform:uppercase}
.loc{font-size:.8rem;opacity:.4;margin-top:4px;letter-spacing:1px}
.clk{font-size:1rem;opacity:.7;margin-top:8px;font-variant-numeric:tabular-nums}

/* Navigation */
.nav{display:flex;justify-content:center;gap:12px;margin-top:20px;position:relative;z-index:10}
.nav button{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);
color:#fff;padding:10px 24px;border-radius:20px;cursor:pointer;font-size:0.95rem;
transition:all 0.3s;font-weight:500}
.nav button:hover{background:rgba(255,255,255,.2);transform:translateY(-2px)}
.nav button.active{background:rgba(255,255,255,.3);border-color:rgba(255,255,255,.5);
box-shadow:0 4px 12px rgba(255,255,255,.2)}

/* Weather Hero */
.hero{display:flex;align-items:center;justify-content:center;gap:24px;margin-top:20px}
.wx-icon{font-size:5rem;filter:drop-shadow(0 4px 16px rgba(0,0,0,.3));animation:fl 3s ease-in-out infinite}
@keyframes fl{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.wx-temp{font-size:5rem;font-weight:100;letter-spacing:-4px}
.wx-deg{font-size:1.6rem;vertical-align:top;opacity:.7}
.wx-desc{font-size:1.15rem;margin-top:4px;opacity:.9;font-weight:500}
.wx-hl{font-size:.85rem;opacity:.5;margin-top:6px;letter-spacing:.5px}
.wx-hl span{font-weight:600;opacity:.8}

.wrap{max-width:920px;margin:-24px auto 0;padding:0 16px 24px;position:relative;z-index:1}

/* Page Management */
.page{display:none}
.page.active{display:block}

/* Status Bar */
.sb{display:flex;align-items:center;justify-content:center;gap:8px;
padding:10px 20px;border-radius:24px;font-size:.8rem;margin:0 auto 16px;
background:var(--card);width:fit-content;border:1px solid rgba(255,255,255,.05)}
.sd{width:9px;height:9px;border-radius:50%;animation:pu 2s infinite}
@keyframes pu{0%,100%{opacity:.4}50%{opacity:1}}
.sd.ok{background:#0f0}
.sd.er{background:#f00}

/* Weather Cards */
.gr{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin-top:16px}
.cd{background:var(--card);border-radius:var(--r);padding:20px;border:1px solid rgba(255,255,255,.05);
transition:transform .2s,box-shadow .2s}
.cd:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,.3)}
.ic{font-size:2rem;margin-bottom:8px}
.lb{font-size:.85rem;opacity:.6;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.vl{font-size:2rem;font-weight:300;margin-bottom:4px}
.un{font-size:1rem;opacity:.6;margin-left:4px}
.su{font-size:.75rem;opacity:.4}

/* Humidity Gauge */
.hg-card{background:var(--card);border-radius:var(--r);padding:24px;margin-top:16px;border:1px solid rgba(255,255,255,.05)}
.tt{font-size:1.1rem;font-weight:500;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.dt{width:12px;height:12px;border-radius:2px}
.hg-track{height:12px;background:linear-gradient(90deg,#8B4513 0%,#a0a0a0 25%,#4ecdc4 50%,#95e1d3 75%,#4a90e2 100%);
border-radius:6px;position:relative;margin-top:12px}
.hg-pin{width:24px;height:24px;background:#fff;border:3px solid var(--bg);border-radius:50%;
position:absolute;top:-6px;transform:translateX(-50%);box-shadow:0 2px 8px rgba(0,0,0,.3);transition:left .3s}
.hg-labels{display:flex;justify-content:space-between;font-size:.75rem;opacity:.6;margin-top:8px}

/* Charts */
.ch{background:var(--card);border-radius:var(--r);padding:20px;margin-top:16px;border:1px solid rgba(255,255,255,.05)}
canvas{width:100%;height:200px;display:block}

/* Office Map Styles */
.office-hero{display:none}
.office-hero.active{display:block}

.office-container{background:var(--card);border-radius:var(--r);padding:40px;margin-top:16px;border:1px solid rgba(255,255,255,.05)}
.office-title{font-size:1.8rem;font-weight:500;margin-bottom:30px;text-align:center;color:#4ecdc4}
.light-info{text-align:center;margin-bottom:30px;font-size:1.2rem}
.light-level{font-weight:bold;color:#ffd93d;font-size:1.3rem}

/* Office Map Layout - Matching Your Drawing */
.office-map{position:relative;width:100%;max-width:700px;height:500px;margin:0 auto;
background:#2a2a3e;border:4px solid #555;border-radius:4px}

/* Room 1 - Top Left */
.room1-outer{position:absolute;left:0;top:0;width:45%;height:50%;
border-right:4px solid #555;border-bottom:4px solid #555}
.room1-door{position:absolute;right:0;top:40%;width:30px;height:60px;
border-right:none;background:#2a2a3e}

/* Room 2 - Top Right (Large) */
.room2-outer{position:absolute;left:45%;top:0;width:55%;height:52%;
border-bottom:4px solid #555}

/* Corridor - Bottom Left */
.corridor-outer{position:absolute;left:0;top:50%;width:62%;height:50%;}
.corridor-door{position:absolute;left:0;bottom:15%;width:60px;height:30px;
border-left:none;background:#2a2a3e}
.corridor-door2{position:absolute;right:40%;bottom:0;width:30px;height:60px;
border-bottom:none;background:#2a2a3e}

/* Room 3 - Bottom Right */
.room3-outer{position:absolute;left:62%;top:52%;width:38%;height:48%;
border-left:4px solid #555;border-top:4px solid #555}
.room3-door{position:absolute;left:0;top:10%;width:30px;height:50px;
border-left:none;background:#2a2a3e}

/* Room Labels and Lights */
.room-content{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
text-align:center}
.room-label{font-size:2.5rem;font-weight:bold;margin-bottom:15px;opacity:0.8}
.light-bulb{width:80px;height:80px;border-radius:50%;background:#333;
margin:15px auto 0;display:flex;align-items:center;justify-content:center;
font-size:3rem;transition:all 0.5s;box-shadow:0 0 0 rgba(255,255,255,0)}
.light-bulb.on{box-shadow:0 0 40px rgba(255,255,255,0.8)}

footer{text-align:center;padding:24px;font-size:.8rem;opacity:.4;margin-top:24px}
</style>
</head>
<body>

<div class="top">
<h1>üå¶Ô∏è M5GO Weather Station</h1>
<div class="loc">NYP Engineering Lab</div>
<div class="clk" id="clk">Loading...</div>

<div class="nav">
  <button class="nav-btn active" onclick="showPage('weather')">Weather Dashboard</button>
  <button class="nav-btn" onclick="showPage('office')">Office Lighting Map</button>
</div>

<!-- Weather Hero (only shows on weather page) -->
<div class="hero" id="weather-hero">
<div class="wx-icon">üå§Ô∏è</div>
<div>
<div class="wx-temp"><span id="t">--</span><span class="wx-deg">¬∞C</span></div>
<div class="wx-desc" id="desc">Refreshing data...</div>
<div class="wx-hl">H: <span id="hi">--</span>¬∞C | L: <span id="lo">--</span>¬∞C</div>
</div>
</div>

<!-- Office Hero (only shows on office page) -->
<div class="office-hero" id="office-hero">
<div class="light-info">
  Current Lighting Level: <span class="light-level" id="light-level-text">Loading...</span>
</div>
</div>

</div>

<div class="wrap">

<!-- Weather Page -->
<div id="weather-page" class="page active">
<div class="sb">
<div class="sd ok" id="st"></div>
<span id="su">Connecting to ThingSpeak...</span>
</div>

<div class="gr">
<div class="cd"><div class="ic">üå°Ô∏è</div><div class="lb">Temperature</div>
<div class="vl" id="tv">--<span class="un">¬∞C</span></div>
<div class="su">Current temperature</div></div>
<div class="cd"><div class="ic">üíß</div><div class="lb">Humidity</div>
<div class="vl" id="hv">--<span class="un">%</span></div>
<div class="su">Relative humidity</div></div>
<div class="cd"><div class="ic">üå¨Ô∏è</div><div class="lb">Pressure</div>
<div class="vl" id="pv">--<span class="un">hPa</span></div>
<div class="su">Atmospheric pressure</div></div>
<div class="cd li"><div class="ic">üå°Ô∏è</div><div class="lb">Heat Index</div>
<div class="vl" id="hiv">--<span class="un">¬∞C</span></div>
<div class="su">Feels like temperature</div></div>
<div class="cd li"><div class="ic">üíé</div><div class="lb">Dew Point</div>
<div class="vl" id="dv">--<span class="un">¬∞C</span></div>
<div class="su">Condensation temperature</div></div>
</div>

<div class="hg-card">
<div class="tt">Humidity Level</div>
<div class="hg-labels"><span>üèúÔ∏è Very Dry</span><span>üòä Comfortable</span><span>üíß Very Humid</span></div>
<div class="hg-track"><div class="hg-pin" id="hp" style="left:50%"></div></div></div>

<div class="ch"><div class="tt"><div class="dt" style="background:#ff6b6b"></div>Temperature History</div>
<canvas id="c1"></canvas></div>
<div class="ch"><div class="tt"><div class="dt" style="background:#4ecdc4"></div>Humidity History</div>
<canvas id="c2"></canvas></div>
<div class="ch"><div class="tt"><div class="dt" style="background:#ffd93d"></div>Pressure History</div>
<canvas id="c3"></canvas></div>
</div>

<!-- Office Map Page -->
<div id="office-page" class="page">
<div class="sb">
<div class="sd ok" id="st2"></div>
<span id="light-status">Monitoring lighting system...</span>
</div>

<div class="office-container">
  <div class="office-title">üè¢ Office Lighting Control System</div>
  
  <div class="office-map">
    <!-- Room 1 - Top Left -->
    <div class="room1-outer">
      <div class="room1-door"></div>
      <div class="room-content">
        <div class="room-label">1</div>
        <div class="light-bulb" id="bulb1">üí°</div>
      </div>
    </div>
    
    <!-- Room 2 - Top Right (Large) -->
    <div class="room2-outer">
      <div class="room-content">
        <div class="room-label">2</div>
        <div class="light-bulb" id="bulb2">üí°</div>
      </div>
    </div>
    
    <!-- Corridor - Bottom Left -->
    <div class="corridor-outer">
      <div class="corridor-door"></div>
      <div class="corridor-door2"></div>
    </div>
    
    <!-- Room 3 - Bottom Right -->
    <div class="room3-outer">
      <div class="room3-door"></div>
      <div class="room-content">
        <div class="room-label">3</div>
        <div class="light-bulb" id="bulb3">üí°</div>
      </div>
    </div>
  </div>
</div>

<div class="ch"><div class="tt"><div class="dt" style="background:#ffd93d"></div>Light Level History</div>
<canvas id="c4"></canvas></div>
</div>

<footer>Live sensor data from M5GO ENV III ¬∑ Powered by ThingSpeak<br>
NYP Engineering Project ¬∑ Updates every 15 seconds</footer>
</div>

<script>
// ThingSpeak Configuration
var CHANNEL = '3260324';
var READ_KEY = 'RSDE9TXRGDX5HIL0';

var fc=0,minT=999,maxT=-999,minH=999,maxH=-999;
var currentPage = 'weather';

function $(id){return document.getElementById(id)}

function showPage(page) {
  currentPage = page;
  
  // Hide all pages
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  
  // Hide/show heroes
  $('weather-hero').style.display = 'none';
  $('office-hero').classList.remove('active');
  
  if(page === 'weather') {
    $('weather-page').classList.add('active');
    $('weather-hero').style.display = 'flex';
    document.querySelectorAll('.nav-btn')[0].classList.add('active');
  } else if(page === 'office') {
    $('office-page').classList.add('active');
    $('office-hero').classList.add('active');
    document.querySelectorAll('.nav-btn')[1].classList.add('active');
  }
}

function updateOfficeLights(lightLevel) {
  var bulb1 = $('bulb1');
  var bulb2 = $('bulb2');
  var bulb3 = $('bulb3');
  var levelText = $('light-level-text');
  var statusText = $('light-status');
  
  // Reset all lights
  bulb1.classList.remove('on');
  bulb2.classList.remove('on');
  bulb3.classList.remove('on');
  bulb1.style.background = '#333';
  bulb2.style.background = '#333';
  bulb3.style.background = '#333';
  
  if(lightLevel === 0) {
    levelText.textContent = 'OFF (0%)';
    levelText.style.color = '#888';
    statusText.textContent = '‚ö´ All lights are OFF';
  } else if(lightLevel === 10) {
    levelText.textContent = 'ECO (10%)';
    levelText.style.color = '#ffff99';
    bulb1.classList.add('on');
    bulb1.style.background = 'radial-gradient(circle, #ffff99, #888800)';
    bulb1.parentElement.parentElement.style.background = 'rgba(255, 255, 153, 0.1)';
    statusText.textContent = 'üü° Room 1 is dimly lit (ECO mode)';
  } else if(lightLevel === 30) {
    levelText.textContent = 'NORMAL (30%)';
    levelText.style.color = '#ffff99';
    bulb1.classList.add('on');
    bulb2.classList.add('on');
    bulb1.style.background = 'radial-gradient(circle, #ffffaa, #aaaa00)';
    bulb2.style.background = 'radial-gradient(circle, #ffff99, #888800)';
    bulb1.parentElement.parentElement.style.background = 'rgba(255, 255, 170, 0.15)';
    bulb2.parentElement.parentElement.style.background = 'rgba(255, 255, 153, 0.1)';
    statusText.textContent = 'üü° Rooms 1 & 2 are lit (NORMAL mode)';
  } else if(lightLevel === 40) {
    levelText.textContent = 'BLUE (40%)';
    levelText.style.color = '#99ffff';
    bulb1.classList.add('on');
    bulb2.classList.add('on');
    bulb1.style.background = 'radial-gradient(circle, #99ffff, #0088aa)';
    bulb2.style.background = 'radial-gradient(circle, #99ffff, #0088aa)';
    bulb1.parentElement.parentElement.style.background = 'rgba(153, 255, 255, 0.15)';
    bulb2.parentElement.parentElement.style.background = 'rgba(153, 255, 255, 0.15)';
    statusText.textContent = 'üîµ Rooms 1 & 2 with blue lighting';
  } else if(lightLevel === 50) {
    levelText.textContent = 'BRIGHT (50%)';
    levelText.style.color = '#ccffff';
    bulb1.classList.add('on');
    bulb2.classList.add('on');
    bulb3.classList.add('on');
    bulb1.style.background = 'radial-gradient(circle, #ccffff, #00aacc)';
    bulb2.style.background = 'radial-gradient(circle, #ccffff, #00aacc)';
    bulb3.style.background = 'radial-gradient(circle, #aaffff, #005566)';
    bulb1.parentElement.parentElement.style.background = 'rgba(204, 255, 255, 0.2)';
    bulb2.parentElement.parentElement.style.background = 'rgba(204, 255, 255, 0.2)';
    bulb3.parentElement.parentElement.style.background = 'rgba(170, 255, 255, 0.15)';
    statusText.textContent = '‚ö™ All rooms are lit (BRIGHT mode)';
  } else if(lightLevel >= 70) {
    levelText.textContent = 'MAX (70%)';
    levelText.style.color = '#ffffff';
    bulb1.classList.add('on');
    bulb2.classList.add('on');
    bulb3.classList.add('on');
    bulb1.style.background = 'radial-gradient(circle, #ffffff, #cccccc)';
    bulb2.style.background = 'radial-gradient(circle, #ffffff, #cccccc)';
    bulb3.style.background = 'radial-gradient(circle, #ffffff, #cccccc)';
    bulb1.parentElement.parentElement.style.background = 'rgba(255, 255, 255, 0.25)';
    bulb2.parentElement.parentElement.style.background = 'rgba(255, 255, 255, 0.25)';
    bulb3.parentElement.parentElement.style.background = 'rgba(255, 255, 255, 0.25)';
    statusText.textContent = '‚ö™ All rooms at MAXIMUM brightness';
  }
}

function drawChart(cv,data,color,unit){
  if(!data||data.length<1)return;
  var c=cv.getContext('2d'),dpr=window.devicePixelRatio||1;
  var W=cv.clientWidth*dpr,H=cv.clientHeight*dpr;
  cv.width=W;cv.height=H;c.clearRect(0,0,W,H);

  c.strokeStyle='rgba(255,255,255,.05)';c.lineWidth=1;
  for(var g=0;g<4;g++){var gy=H*(.2+g*.2);
  c.beginPath();c.moveTo(0,gy);c.lineTo(W,gy);c.stroke()}

  var mn=data[0],mx=data[0];
  for(var i=1;i<data.length;i++){if(data[i]<mn)mn=data[i];if(data[i]>mx)mx=data[i]}
  var rn=mx-mn||1,pd=H*.15,pts=[];
  for(var i=0;i<data.length;i++){
    var x=data.length===1?W/2:(i/(data.length-1))*W;
    var y=H-pd-((data[i]-mn)/rn)*(H-2*pd);pts.push([x,y])}

  var gr=c.createLinearGradient(0,0,0,H);
  gr.addColorStop(0,color+'40');gr.addColorStop(.5,color+'15');gr.addColorStop(1,color+'00');
  c.fillStyle=gr;c.beginPath();c.moveTo(pts[0][0],H);
  for(var i=0;i<pts.length;i++)c.lineTo(pts[i][0],pts[i][1]);
  c.lineTo(pts[pts.length-1][0],H);c.closePath();c.fill();

  c.strokeStyle=color;c.lineWidth=2*dpr;c.lineJoin='round';c.lineCap='round';
  c.beginPath();c.moveTo(pts[0][0],pts[0][1]);
  for(var i=1;i<pts.length;i++)c.lineTo(pts[i][0],pts[i][1]);
  c.stroke();

  for(var i=0;i<pts.length;i++){
    c.fillStyle=color;c.beginPath();c.arc(pts[i][0],pts[i][1],3*dpr,0,Math.PI*2);c.fill();
    c.strokeStyle='#1a1a2e';c.lineWidth=2*dpr;c.stroke()}

  c.fillStyle='rgba(255,255,255,.7)';c.font=(12*dpr)+'px sans-serif';c.textAlign='left';
  c.fillText((mn.toFixed(1))+unit,8,H-8);c.textAlign='right';
  c.fillText((mx.toFixed(1))+unit,W-8,20*dpr)}

function updClk(){var n=new Date(),h=n.getHours(),m=n.getMinutes(),s=n.getSeconds();
$('clk').textContent=(h<10?'0':'')+h+':'+(m<10?'0':'')+m+':'+(s<10?'0':'')+s}
setInterval(updClk,1000);updClk();

function fetch(){
  var url='https://api.thingspeak.com/channels/'+CHANNEL+'/feeds.json?api_key='+READ_KEY+'&results=20';
  var xhr=new XMLHttpRequest();
  xhr.open('GET',url,true);
  xhr.onload=function(){
    if(xhr.status===200){
      try{
        var d=JSON.parse(xhr.responseText);
        if(d.feeds&&d.feeds.length>0){
          fc++;
          var f=d.feeds[d.feeds.length-1];
          var temp=parseFloat(f.field1)||0;
          var hum=parseFloat(f.field2)||0;
          var pres=parseFloat(f.field3)||0;
          var light=parseFloat(f.field4)||0;
          var dew=parseFloat(f.field5)||0;
          var heat=parseFloat(f.field6)||0;

          $('t').textContent=temp.toFixed(1);
          $('tv').innerHTML=temp.toFixed(1)+'<span class="un">¬∞C</span>';
          $('hv').innerHTML=hum.toFixed(1)+'<span class="un">%</span>';
          $('pv').innerHTML=pres.toFixed(1)+'<span class="un">hPa</span>';
          $('hiv').innerHTML=heat.toFixed(1)+'<span class="un">¬∞C</span>';
          $('dv').innerHTML=dew.toFixed(1)+'<span class="un">¬∞C</span>';

          if(temp<minT)minT=temp;if(temp>maxT)maxT=temp;
          if(hum<minH)minH=hum;if(hum>maxH)maxH=hum;
          $('hi').textContent=maxT.toFixed(1);
          $('lo').textContent=minT.toFixed(1);

          if(temp<10){$('desc').textContent='Very Cold';$('desc').style.color='#00d4ff'}
          else if(temp<18){$('desc').textContent='Cold';$('desc').style.color='#4ecdc4'}
          else if(temp<25){$('desc').textContent='Comfortable';$('desc').style.color='#95e1d3'}
          else if(temp<30){$('desc').textContent='Warm';$('desc').style.color='#ffd93d'}
          else{$('desc').textContent='Hot';$('desc').style.color='#ff6b6b'}

          $('hp').style.left=Math.max(0,Math.min(100,hum))+'%';
          
          // Update office lights
          updateOfficeLights(light);

          var tempData=[],humData=[],presData=[],lightData=[];
          for(var i=0;i<d.feeds.length;i++){
            tempData.push(parseFloat(d.feeds[i].field1)||0);
            humData.push(parseFloat(d.feeds[i].field2)||0);
            presData.push(parseFloat(d.feeds[i].field3)||0);
            lightData.push(parseFloat(d.feeds[i].field4)||0);
          }

          drawChart($('c1'),tempData,'#ff6b6b','¬∞C');
          drawChart($('c2'),humData,'#4ecdc4','%');
          drawChart($('c3'),presData,'#ffd93d','hPa');
          drawChart($('c4'),lightData,'#ffd93d','%');

          $('st').className='sd ok';
          $('st2').className='sd ok';
          $('su').textContent='Live ¬∑ Updated '+fc+' times';
        }
      }catch(e){$('st').className='sd er';$('st2').className='sd er';$('su').textContent='Parse error'}}
    else{$('st').className='sd er';$('st2').className='sd er';$('su').textContent='Connection failed'}
  };
  xhr.onerror=function(){$('st').className='sd er';$('st2').className='sd er';$('su').textContent='Network error'};
  xhr.send()}

fetch();
setInterval(fetch,15000);
</script>

</body>
</html>
